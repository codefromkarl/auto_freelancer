{
  "name": "Telegram Callback Handler",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "telegram-callback",
        "options": {}
      },
      "id": "webhook",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [400, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://python_service:8000/api/v1/messages/telegram/callback",
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-Key",
              "value": "={{$env.PYTHON_API_KEY}}"
            }
          ]
        },
        "bodyParameters": {
          "parameters": [
            {
              "name": "callback_data",
              "value": "={{$json.body.callback_query.data}}"
            }
          ]
        },
        "options": {}
      },
      "id": "call_api",
      "name": "Call Callback API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [600, 300]
    },
    {
      "parameters": {
        "chatId": "={{$json.body.callback_query.message.chat.id}}",
        "messageId": "={{$json.body.callback_query.message.message_id}}",
        "text": "=处理成功: {{$node[\"call_api\"].json[\"data\"][{\"message\"]}}",
        "replyMarkup": "none"
      },
      "id": "update_tg",
      "name": "Update TG Message",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [800, 300]
    }
  ],
  "connections": {
    "webhook": {
      "main": [
        [
          {
            "node": "call_api",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "call_api": {
      "main": [
        [
          {
            "node": "update_tg",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}